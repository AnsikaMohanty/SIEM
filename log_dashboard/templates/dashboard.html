<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Server Log Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: white;
            font-family: 'Poppins', sans-serif;
            color: #2c3e50;
        }

        h2 {
            font-weight: 700;
            margin-bottom: 1.5rem;
            font-size: 2.5rem;
        }

        .glass-card {
            background: #f8f9fa;
            border-radius: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        .stat-number {
            font-size: 2.25rem;
            font-weight: 600;
        }

        .badge {
            font-size: 1rem;
            padding: 0.6em 0.9em;
        }

        .list-group-item {
            background: transparent;
            border: none;
            border-bottom: 1px solid #dee2e6;
        }

        canvas {
            height: 250px !important;
        }

        .section-header {
            background: linear-gradient(90deg, #20c997, #17a2b8);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            font-weight: 700;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .mini-section-header {
            background: linear-gradient(90deg, #20c997, #17a2b8);
            color: white;
            padding: 0.6rem;
            border-radius: 10px;
            font-size: 1.25rem;
            text-align: center;
            margin-bottom: 1rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container my-5">
        <h2 class="text-center">Server Access Log Dashboard</h2>

        <!-- Stats Section -->
        <div class="section-header">Request Statistics</div>
        <div class="row text-center mb-4">
            <div class="col-md-4 mb-3">
                <div class="glass-card">
                    <h5>Total Requests</h5>
                    <div class="stat-number text-primary">{{ stats.total }}</div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="glass-card">
                    <h5>GET Requests</h5>
                    <div class="stat-number text-success">{{ stats.method_counts.get('GET', 0) }}</div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="glass-card">
                    <h5>POST Requests</h5>
                    <div class="stat-number text-danger">{{ stats.method_counts.get('POST', 0) }}</div>
                </div>
            </div>
        </div>

        <!-- Top IPs -->
        <div class="section-header">Top IP Addresses</div>
        <ul class="list-group mb-5">
            {% for ip, count in stats.ip_counts.items() %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <span>{{ ip }}</span>
                <span class="badge bg-dark rounded-pill">{{ count }}</span>
            </li>
            {% endfor %}
        </ul>

        <!-- Charts Section -->
        <div class="section-header">Request Trends</div>
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="glass-card">
                    <div class="mini-section-header">Daily Requests</div>
                    <canvas id="dailyChart"></canvas>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="glass-card">
                    <div class="mini-section-header">Method Types</div>
                    <canvas id="methodChart"></canvas>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="glass-card">
                    <div class="mini-section-header">IP Distribution</div>
                    <canvas id="ipChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script id="stats-data" type="application/json">
        {
            "method_counts": {{ stats.method_counts | tojson }},
            "ip_counts": {{ stats.ip_counts | tojson }},
            "daily_counts": {{ stats.daily_counts | tojson }}
        }
    </script>

    <script>
        const statsData = JSON.parse(document.getElementById('stats-data').textContent);

        new Chart(document.getElementById('dailyChart'), {
            type: 'line',
            data: {
                labels: Object.keys(statsData.daily_counts),
                datasets: [{
                    label: 'Requests',
                    data: Object.values(statsData.daily_counts),
                    borderColor: '#6f42c1',
                    backgroundColor: 'rgba(111, 66, 193, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } }
            }
        });

        new Chart(document.getElementById('methodChart'), {
            type: 'bar',
            data: {
                labels: ['GET', 'POST'],
                datasets: [{
                    label: 'Count',
                    data: [
                        statsData.method_counts['GET'] || 0,
                        statsData.method_counts['POST'] || 0
                    ],
                    backgroundColor: ['#20c997', '#fd7e14']
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } }
            }
        });

        new Chart(document.getElementById('ipChart'), {
            type: 'pie',
            data: {
                labels: Object.keys(statsData.ip_counts),
                datasets: [{
                    data: Object.values(statsData.ip_counts),
                    backgroundColor: ['#ff7675', '#74b9ff', '#55efc4', '#ffeaa7', '#a29bfe']
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { position: 'bottom' } }
            }
        });
    </script>
</body>
</html>
